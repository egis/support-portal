
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>High Availability Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-pygments/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="jobs-text.html" />
    
    
    <link rel="prev" href="health-text.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../configuration/advanced-login.html">
            
                <a href="../configuration/advanced-login.html">
            
                    
                    Advanced Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../configuration/advanced-permissions.html">
            
                <a href="../configuration/advanced-permissions.html">
            
                    
                    Advanced Permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../configuration/backups-text.html">
            
                <a href="../configuration/backups-text.html">
            
                    
                    Backups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../configuration/barcode-text.html">
            
                <a href="../configuration/barcode-text.html">
            
                    
                    Barcode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../configuration/branding-text.html">
            
                <a href="../configuration/branding-text.html">
            
                    
                    Branding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../configuration/bulk-capture-text.html">
            
                <a href="../configuration/bulk-capture-text.html">
            
                    
                    Bulk Capture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../configuration/eSign.html">
            
                <a href="../configuration/eSign.html">
            
                    
                    eSign
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../configuration/indexes.html">
            
                <a href="../configuration/indexes.html">
            
                    
                    Indexes / Meta Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../configuration/logging-text.html">
            
                <a href="../configuration/logging-text.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../configuration/security.html">
            
                <a href="../configuration/security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../configuration/ssl.html">
            
                <a href="../configuration/ssl.html">
            
                    
                    SSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../configuration/sso-text.html">
            
                <a href="../configuration/sso-text.html">
            
                    
                    Single-Sign-On (SSO)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../configuration/template-extraction.html">
            
                <a href="../configuration/template-extraction.html">
            
                    
                    Template Extraction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../configuration/user-export-and-import.html">
            
                <a href="../configuration/user-export-and-import.html">
            
                    
                    User Export and Import
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="../configuration/user-management.html">
            
                <a href="../configuration/user-management.html">
            
                    
                    User Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="../configuration/queues.html">
            
                <a href="../configuration/queues.html">
            
                    
                    Queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="../configuration/webscan-text.html">
            
                <a href="../configuration/webscan-text.html">
            
                    
                    WebScan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.18" data-path="../configuration/yaml-config.html">
            
                <a href="../configuration/yaml-config.html">
            
                    
                    YAML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    End User Installation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../installation/desktop-agent.html">
            
                <a href="../installation/desktop-agent.html">
            
                    
                    Desktop Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../installation/ms-office-add-in.html">
            
                <a href="../installation/ms-office-add-in.html">
            
                    
                    MS Office Add In
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../installation/end-user-installation.html">
            
                <a href="../installation/end-user-installation.html">
            
                    
                    End User Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Server Installation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../installation/cli-article.html">
            
                <a href="../installation/cli-article.html">
            
                    
                    CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../installation/sizing-text.html">
            
                <a href="../installation/sizing-text.html">
            
                    
                    Sizing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../installation/server-installation.html">
            
                <a href="../installation/server-installation.html">
            
                    
                    Server Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../installation/macosx.html">
            
                <a href="../installation/macosx.html">
            
                    
                    Mac OS X
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../installation/ubuntu-linux-text.html">
            
                <a href="../installation/ubuntu-linux-text.html">
            
                    
                    Ubuntu Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../installation/Windows.html">
            
                <a href="../installation/Windows.html">
            
                    
                    Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../installation/service.html">
            
                <a href="../installation/service.html">
            
                    
                    Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../installation/solution.html">
            
                <a href="../installation/solution.html">
            
                    
                    Solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Integration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../integration/database-text.html">
            
                <a href="../integration/database-text.html">
            
                    
                    Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../integration/data-sources-text.html">
            
                <a href="../integration/data-sources-text.html">
            
                    
                    Data Sources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../integration/easypdf-text.html">
            
                <a href="../integration/easypdf-text.html">
            
                    
                    Easy PDF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../integration/email-watch-text.html">
            
                <a href="../integration/email-watch-text.html">
            
                    
                    Email Watch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../integration/folder-export-text.html">
            
                <a href="../integration/folder-export-text.html">
            
                    
                    Folder Export
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../integration/folder-watch-text.html">
            
                <a href="../integration/folder-watch-text.html">
            
                    
                    Folder Watch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../integration/ldap-ad-text.html">
            
                <a href="../integration/ldap-ad-text.html">
            
                    
                    LDAP / Active Directory
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Reference
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="best-practises.html">
            
                <a href="best-practises.html">
            
                    
                    Best Practises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="cold-standby-failover-procedure-text.html">
            
                <a href="cold-standby-failover-procedure-text.html">
            
                    
                    Cold Standby Failover Procedure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="docexport.html">
            
                <a href="docexport.html">
            
                    
                    Document Export
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="encryption-text.html">
            
                <a href="encryption-text.html">
            
                    
                    Encryption
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="linking-text.html">
            
                <a href="linking-text.html">
            
                    
                    Linking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="logging-text.html">
            
                <a href="logging-text.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="jobs-text.html">
            
                <a href="jobs-text.html">
            
                    
                    Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="document-properties-text.html">
            
                <a href="document-properties-text.html">
            
                    
                    Document Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="encryption-text.html">
            
                <a href="encryption-text.html">
            
                    
                    Encryption
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="health-text.html">
            
                <a href="health-text.html">
            
                    
                    Health
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.12" data-path="high-availability-text.html">
            
                <a href="high-availability-text.html">
            
                    
                    High Availability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="jobs-text.html">
            
                <a href="jobs-text.html">
            
                    
                    Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="linking-text.html">
            
                <a href="linking-text.html">
            
                    
                    Linking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="logging-text.html">
            
                <a href="logging-text.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="licensing-text.html">
            
                <a href="licensing-text.html">
            
                    
                    Licensing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="linking-syntax-text.html">
            
                <a href="linking-syntax-text.html">
            
                    
                    Linking Syntax
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="maintenance-text.html">
            
                <a href="maintenance-text.html">
            
                    
                    Maintenance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="permissions.html">
            
                <a href="permissions.html">
            
                    
                    Permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="pql-text.html">
            
                <a href="pql-text.html">
            
                    
                    PQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.21" data-path="regex-text.html">
            
                <a href="regex-text.html">
            
                    
                    Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.22" data-path="standard-expression-text.html">
            
                <a href="standard-expression-text.html">
            
                    
                    Standard Expression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.23" data-path="system-nodes-text.html">
            
                <a href="system-nodes-text.html">
            
                    
                    System Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.24" data-path="system-properties.html">
            
                <a href="system-properties.html">
            
                    
                    System Properties
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Troubleshooting
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../troubleshooting/cpu-usage-text.html">
            
                <a href="../troubleshooting/cpu-usage-text.html">
            
                    
                    CPU Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../troubleshooting/db-tuning-text.html">
            
                <a href="../troubleshooting/db-tuning-text.html">
            
                    
                    DB Tuning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../troubleshooting/exceptions-text.html">
            
                <a href="../troubleshooting/exceptions-text.html">
            
                    
                    Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../troubleshooting/dripstat-configuration-text.html">
            
                <a href="../troubleshooting/dripstat-configuration-text.html">
            
                    
                    Dripstat Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../troubleshooting/messaging.html">
            
                <a href="../troubleshooting/messaging.html">
            
                    
                    Messaging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../troubleshooting/performance-text.html">
            
                <a href="../troubleshooting/performance-text.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../troubleshooting/troubleshooting-client-text.html">
            
                <a href="../troubleshooting/troubleshooting-client-text.html">
            
                    
                    Troubleshooting Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../troubleshooting/troubleshooting-server.html">
            
                <a href="../troubleshooting/troubleshooting-server.html">
            
                    
                    Troubleshooting Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >High Availability</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="high-availability"><a name="high-availability" class="plugin-anchor" href="#high-availability"><i class="fa fa-link" aria-hidden="true"></i></a>High Availability</h1>
<!-- toc --><div id="toc" class="toc">

<ul>
<li><a href="#master-node">Master Node</a></li>
<li><a href="#file-replication">File Replication</a></li>
<li><a href="#index-replication">Index Replication</a><ul>
<li><a href="#replication">Replication</a></li>
<li><a href="#clustering">Clustering</a></li>
</ul>
</li>
<li><a href="#shared-db-vs-replication-db">Shared DB vs Replication DB</a><ul>
<li><a href="#cold-standby">Cold Standby</a></li>
<li><a href="#warm-standby">Warm Standby</a></li>
</ul>
</li>
</ul>

</div><!-- tocstop -->
<p>PaperTrail support 4 distinct modes of HA operation:</p>
<ol>
<li>Replication</li>
<li>Clustering</li>
<li>Cold/Warm Standby</li>
</ol>
<h3 id="master-node"><a name="master-node" class="plugin-anchor" href="#master-node"><i class="fa fa-link" aria-hidden="true"></i></a>Master Node</h3>
<p>Whether using replication or clustering, which node is configured as master will matter is it is responsible for running a number of background jobs including:</p>
<ul>
<li>workflow and allocation timeouts</li>
<li>scheduled rules</li>
<li>out of office start/end</li>
<li>diarize start</li>
<li>reminders</li>
</ul>
<p>Should the master fail, a new master needs to be configured.</p>
<p><strong>Email</strong> and <strong>Folder</strong> watches are configured per server/node so that load can be manually balanced, should a node fail, then the watches that were configured for it will need to be manually moved.</p>
<h3 id="file-replication"><a name="file-replication" class="plugin-anchor" href="#file-replication"><i class="fa fa-link" aria-hidden="true"></i></a>File Replication</h3>
<p> PaperTrail has a builtin file replication engine that supports both <strong>master-master</strong> and <strong>master-slave</strong> it is configued by specifying:</p>
<pre><code> file.replication.upstream=http://slave:8080
</code></pre><p> In the background this configures 2 File/Blob stores:</p>
<ol>
<li>A sync local filesystem store (only a single sync store is supported and is considered the primary)</li>
<li>An async persistent sencondary store   </li>
</ol>
<blockquote>
<p><strong>Async</strong> stores fully support intermittent WAN connections and will retry all operations. All operations are queued under the <code>{store name}.write</code> and  <code>{store name}.delete</code> message queues</p>
</blockquote>
<p>Their are 2 alternatives to full replication of files:</p>
<ol>
<li>configure the slave or secondary members to read/write files from the master using a <strong>HTTP</strong> store as the primary sync store. It is recommended to enable <strong>WORM</strong> (Write once read many) on secondary nodes </li>
<li>Use an object storage platform like Amazon S3 and have all members use it as the primary </li>
</ol>
<blockquote>
<p>PaperTrail needs low latency access to the primary sync file store so if you are using Amazon S3 ensure that PaperTrail is hosted in the same AWS region as the  S3 bucket.</p>
</blockquote>
<h3 id="index-replication"><a name="index-replication" class="plugin-anchor" href="#index-replication"><i class="fa fa-link" aria-hidden="true"></i></a>Index Replication</h3>
<p>Specifing a slave server for <code>index.upstream</code> will only work for 2 node clusters, for 2+ nodes switch to messaging based replication using:</p>
<pre><code>index.upstream=topic
</code></pre><p>It is recommended in both scenarios to setup a scheduled <code>index_repair</code> task.</p>
<h2 id="replication"><a name="replication" class="plugin-anchor" href="#replication"><i class="fa fa-link" aria-hidden="true"></i></a>Replication</h2>
<p><img src="../images/ha-replication.png" alt="replication"></p>
<p>To convert a standalone installation to a replicated installation, follow these steps:  </p>
<ul>
<li>Stop PaperTrail and create a <strong>database backup</strong>.  </li>
<li>Configure the following properties in <strong>papertrail.properties</strong> on the master</li>
</ul>
<pre><code class="lang-javascript"><span class="nx">index</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//slave:8080</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//slave:8080</span>
<span class="nx">file</span><span class="p">.</span><span class="nx">replication</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//slave:8080</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">master</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">increment</span><span class="o">=</span><span class="mi">2</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">offset</span><span class="o">=</span><span class="mi">1</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">override</span><span class="o">=</span><span class="kc">true</span> <span class="err">#</span> <span class="k">for</span> <span class="nx">sql</span> <span class="nx">server</span> <span class="nx">replication</span> <span class="nx">only</span> <span class="p">(</span><span class="nx">maybe</span><span class="o">?</span><span class="p">)</span>
</code></pre>
<ul>
<li>Configure these properties on the slave:  </li>
</ul>
<pre><code class="lang-javascript"><span class="nx">index</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//master:8080</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//master:8080</span>
<span class="nx">file</span><span class="p">.</span><span class="nx">replication</span><span class="p">.</span><span class="nx">upstream</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//master:8080</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">master</span><span class="o">=</span><span class="kc">false</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">increment</span><span class="o">=</span><span class="mi">2</span>
<span class="nx">replication</span><span class="p">.</span><span class="nx">offset</span><span class="o">=</span><span class="mi">2</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">override</span><span class="o">=</span><span class="kc">true</span> <span class="err">#</span> <span class="k">for</span> <span class="nx">sql</span> <span class="nx">server</span> <span class="nx">replication</span> <span class="nx">only</span> <span class="p">(</span><span class="nx">maybe</span><span class="o">?</span><span class="p">)</span>
</code></pre>
<ul>
<li>Start up the master</li>
<li>Wait a few minutes and start up the slave</li>
</ul>
<p>When setup, the Messages table (Services &gt; Messages) will show:</p>
<p><code>store.write.replication</code> relates to the document on disk replication (master and slave maintain diferent numbers based on where the document was imported).</p>
<p><code>IndexReplicator.replicate</code> relates to the index replication (master and slave maintain diferent numbers based on where the index was updated).</p>
<p><strong>Note:</strong> Should the Master fail, the Slave needs to be reconfigured with <code>replication.master=true</code> to allow it to run as the Master Node and execute the background jobs as described above. The <code>index.upstream</code>, <code>replication.upstream</code>, <code>file.replication.upstream</code> should be hashed out. <code>replication.increment</code> and <code>replication.offset</code> should be left in place.<br>
Once the Master server is back online, then the Slave DB and Repository will need to be replicated back to the Master server (with PaperTrail offline on both to get them both in the same static state). Then the replication properties can be added back with only one <code>replication.master</code> set to true.<br>
Vice-versa should the Slave fail.</p>
<h2 id="clustering"><a name="clustering" class="plugin-anchor" href="#clustering"><i class="fa fa-link" aria-hidden="true"></i></a>Clustering</h2>
<p><img src="../images/ha-clustering.png" alt="replication"></p>
<blockquote>
<p>Note: Clustering requires a low latency (&lt;1ms), reliable (preferably dual path redundant network) network connection to function correctly.  Replication can be used in WAN environments.</p>
</blockquote>
<ol>
<li>Ensure that port <code>5701</code> is open for inbound traffic from all cluster members to all cluster members. See <a href="http://docs.hazelcast.org/docs/3.3/manual/html/ports.html" target="_blank">Hazelcast Ports</a></li>
<li>Add these properties to the <strong>papertrail.properties</strong>  <pre><code>index.upstream=http://slave:8080
cluster.enable=true
file.replication.upstream=http://slave:8080
</code></pre></li>
<li>Restart PaperTrail.</li>
</ol>
<h3 id="shared-db-vs-replication-db"><a name="shared-db-vs-replication-db" class="plugin-anchor" href="#shared-db-vs-replication-db"><i class="fa fa-link" aria-hidden="true"></i></a>Shared DB vs Replication DB</h3>
<h2 id="cold-standby"><a name="cold-standby" class="plugin-anchor" href="#cold-standby"><i class="fa fa-link" aria-hidden="true"></i></a>Cold Standby</h2>
<p><img src="../images/ha-cold.png" alt="replication"></p>
<p>Indexes are not replicated and PaperTrail is only started in file store replication receive mode. Failover requires re-configuration of PaperTrail for full operation + rebuilding indexes.</p>
<h2 id="warm-standby"><a name="warm-standby" class="plugin-anchor" href="#warm-standby"><i class="fa fa-link" aria-hidden="true"></i></a>Warm Standby</h2>
<p><img src="../images/ha-standby.png" alt="replication"></p>
<p>Everything is replicated in near realtime, and PaperTrail is started in read only mode. Failover requires restarting PaperTrail in read/write mode.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="health-text.html" class="navigation navigation-prev " aria-label="Previous page: Health">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="jobs-text.html" class="navigation navigation-next " aria-label="Next page: Jobs">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"High Availability","level":"1.6.12","depth":2,"next":{"title":"Jobs","level":"1.6.13","depth":2,"path":"reference/jobs-text.md","ref":"reference/jobs-text.md","articles":[]},"previous":{"title":"Health","level":"1.6.11","depth":2,"path":"reference/health-text.md","ref":"reference/health-text.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["edit-link","etoc","anchors","expandable-chapters","pygments"],"pluginsConfig":{"etoc":{"mindepth":3,"maxdepth":4,"header":1,"h2lb":3,"notoc":false},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"pygments":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/egis/support-portal/blob/master/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"reference/high-availability-text.md","mtime":"2021-05-21T07:58:28.395Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-21T07:59:22.669Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

